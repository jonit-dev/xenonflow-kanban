openapi: 3.0.3
info:
  title: XenonFlow Kanban API
  description: |
    REST API for the XenonFlow Kanban board application.

    This API allows AI agents and clients to manage projects, epics, tickets, and users.
  version: 1.0.0
  contact:
    name: XenonFlow

servers:
  - url: http://localhost:3000
    description: Local development server
  - url: https://api.xenonflow.com
    description: Production server

tags:
  - name: Health
    description: Health check endpoints
  - name: Projects
    description: Project management
  - name: Epics
    description: Epic management within projects
  - name: Tickets
    description: Ticket/task management
  - name: Users
    description: User management

paths:
  /health:
    get:
      tags: [Health]
      summary: Health check
      description: Check if the API is running
      operationId: healthCheck
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  timestamp:
                    type: string
                    format: date-time

  /api/projects:
    get:
      tags: [Projects]
      summary: List all projects
      description: Get a list of all projects
      operationId: listProjects
      responses:
        '200':
          description: List of projects
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Project'
    post:
      tags: [Projects]
      summary: Create a project
      description: Create a new project
      operationId: createProject
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectDto'
      responses:
        '201':
          description: Project created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'

  /api/projects/{id}:
    get:
      tags: [Projects]
      summary: Get a project
      description: Get a project by ID
      operationId: getProject
      parameters:
        - $ref: '#/components/parameters/ProjectId'
      responses:
        '200':
          description: Project details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '404':
          description: Project not found
    put:
      tags: [Projects]
      summary: Update a project
      description: Update a project by ID
      operationId: updateProject
      parameters:
        - $ref: '#/components/parameters/ProjectId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProjectDto'
      responses:
        '200':
          description: Project updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '404':
          description: Project not found
    delete:
      tags: [Projects]
      summary: Delete a project
      description: Delete a project by ID
      operationId: deleteProject
      parameters:
        - $ref: '#/components/parameters/ProjectId'
      responses:
        '204':
          description: Project deleted
        '404':
          description: Project not found

  /api/projects/{id}/details:
    get:
      tags: [Projects]
      summary: Get project with details
      description: Get a project with all its epics and tickets
      operationId: getProjectWithDetails
      parameters:
        - $ref: '#/components/parameters/ProjectId'
      responses:
        '200':
          description: Project with epics and tickets
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectWithDetails'
        '404':
          description: Project not found

  /api/epics:
    post:
      tags: [Epics]
      summary: Create an epic
      description: Create a new epic within a project
      operationId: createEpic
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEpicDto'
      responses:
        '201':
          description: Epic created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Epic'

  /api/epics/project/{projectId}:
    get:
      tags: [Epics]
      summary: List project epics
      description: Get all epics for a project
      operationId: listProjectEpics
      parameters:
        - $ref: '#/components/parameters/ProjectId'
      responses:
        '200':
          description: List of epics
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Epic'

  /api/epics/{id}:
    get:
      tags: [Epics]
      summary: Get an epic
      description: Get an epic by ID
      operationId: getEpic
      parameters:
        - $ref: '#/components/parameters/EpicId'
      responses:
        '200':
          description: Epic details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Epic'
        '404':
          description: Epic not found
    put:
      tags: [Epics]
      summary: Update an epic
      description: Update an epic by ID
      operationId: updateEpic
      parameters:
        - $ref: '#/components/parameters/EpicId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEpicDto'
      responses:
        '200':
          description: Epic updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Epic'
        '404':
          description: Epic not found
    delete:
      tags: [Epics]
      summary: Delete an epic
      description: Delete an epic by ID
      operationId: deleteEpic
      parameters:
        - $ref: '#/components/parameters/EpicId'
      responses:
        '204':
          description: Epic deleted
        '404':
          description: Epic not found

  /api/tickets:
    post:
      tags: [Tickets]
      summary: Create a ticket
      description: Create a new ticket within a project
      operationId: createTicket
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTicketDto'
      responses:
        '201':
          description: Ticket created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ticket'

  /api/tickets/project/{projectId}:
    get:
      tags: [Tickets]
      summary: List project tickets
      description: Get all tickets for a project
      operationId: listProjectTickets
      parameters:
        - $ref: '#/components/parameters/ProjectId'
      responses:
        '200':
          description: List of tickets
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Ticket'

  /api/tickets/{id}:
    get:
      tags: [Tickets]
      summary: Get a ticket
      description: Get a ticket by ID
      operationId: getTicket
      parameters:
        - $ref: '#/components/parameters/TicketId'
      responses:
        '200':
          description: Ticket details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ticket'
        '404':
          description: Ticket not found
    put:
      tags: [Tickets]
      summary: Update a ticket
      description: Update a ticket by ID
      operationId: updateTicket
      parameters:
        - $ref: '#/components/parameters/TicketId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTicketDto'
      responses:
        '200':
          description: Ticket updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ticket'
        '404':
          description: Ticket not found
    delete:
      tags: [Tickets]
      summary: Delete a ticket
      description: Delete a ticket by ID
      operationId: deleteTicket
      parameters:
        - $ref: '#/components/parameters/TicketId'
      responses:
        '204':
          description: Ticket deleted
        '404':
          description: Ticket not found

  /api/tickets/{id}/status:
    patch:
      tags: [Tickets]
      summary: Update ticket status
      description: Update the status of a ticket (for drag-and-drop)
      operationId: updateTicketStatus
      parameters:
        - $ref: '#/components/parameters/TicketId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  $ref: '#/components/schemas/TicketStatus'
      responses:
        '200':
          description: Ticket status updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ticket'
        '404':
          description: Ticket not found

  /api/users:
    get:
      tags: [Users]
      summary: List all users
      description: Get a list of all users
      operationId: listUsers
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
    post:
      tags: [Users]
      summary: Create a user
      description: Create a new user
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserDto'
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /api/users/{id}:
    get:
      tags: [Users]
      summary: Get a user
      description: Get a user by ID
      operationId: getUser
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: User not found
    put:
      tags: [Users]
      summary: Update a user
      description: Update a user by ID
      operationId: updateUser
      parameters:
        - $ref: '#/components/parameters/UserId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserDto'
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: User not found
    delete:
      tags: [Users]
      summary: Delete a user
      description: Delete a user by ID
      operationId: deleteUser
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '204':
          description: User deleted
        '404':
          description: User not found

components:
  parameters:
    ProjectId:
      name: id
      in: path
      required: true
      description: Project ID
      schema:
        type: string
      example: p-1738089600000-abc123
    EpicId:
      name: id
      in: path
      required: true
      description: Epic ID
      schema:
        type: string
      example: e-1738089600000-xyz789
    TicketId:
      name: id
      in: path
      required: true
      description: Ticket ID
      schema:
        type: string
      example: t-1738089600000-def456
    UserId:
      name: id
      in: path
      required: true
      description: User ID
      schema:
        type: string
      example: u-1738089600000-ghi012

  schemas:
    TicketStatus:
      type: string
      enum: [BACKLOG, TODO, IN_PROGRESS, REVIEW, DONE]
      description: Status of a ticket in the workflow

    TicketPriority:
      type: string
      enum: [low, medium, high, critical]
      description: Priority level of a ticket

    Project:
      type: object
      properties:
        id:
          type: string
          description: Unique project identifier
        name:
          type: string
          description: Project name
        description:
          type: string
          description: Optional project description
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, name, createdAt, updatedAt]

    ProjectWithDetails:
      allOf:
        - $ref: '#/components/schemas/Project'
        - type: object
          properties:
            epics:
              type: array
              items:
                $ref: '#/components/schemas/Epic'
            tickets:
              type: array
              items:
                $ref: '#/components/schemas/Ticket'
          required: [epics, tickets]

    Epic:
      type: object
      properties:
        id:
          type: string
        projectId:
          type: string
        name:
          type: string
        color:
          type: string
          description: Hex color code
          pattern: '^#[0-9A-Fa-f]{6}$'
        position:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, projectId, name, color, position, createdAt, updatedAt]

    Ticket:
      type: object
      properties:
        id:
          type: string
        projectId:
          type: string
        epicId:
          type: string
          description: Optional epic association
        assigneeId:
          type: string
          description: Optional user assignment
        title:
          type: string
        description:
          type: string
        status:
          $ref: '#/components/schemas/TicketStatus'
        priority:
          $ref: '#/components/schemas/TicketPriority'
        storyPoints:
          type: integer
          minimum: 0
        startDate:
          type: string
          format: date
          pattern: '^[0-9]{4}-[0-9]{2}-[0-9]{2}$'
        endDate:
          type: string
          format: date
          pattern: '^[0-9]{4}-[0-9]{2}-[0-9]{2}$'
        aiInsights:
          type: string
          description: AI-generated insights about the ticket
        position:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, projectId, title, status, priority, storyPoints, position, createdAt, updatedAt]

    User:
      type: object
      properties:
        id:
          type: string
        username:
          type: string
        email:
          type: string
          format: email
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, username, email, createdAt, updatedAt]

    CreateProjectDto:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
      required: [name]

    UpdateProjectDto:
      type: object
      properties:
        name:
          type: string
        description:
          type: string

    CreateEpicDto:
      type: object
      properties:
        projectId:
          type: string
        name:
          type: string
        color:
          type: string
          pattern: '^#[0-9A-Fa-f]{6}$'
          default: '#06b6d4'
      required: [projectId, name]

    UpdateEpicDto:
      type: object
      properties:
        name:
          type: string
        color:
          type: string
          pattern: '^#[0-9A-Fa-f]{6}$'

    CreateTicketDto:
      type: object
      properties:
        projectId:
          type: string
        title:
          type: string
        description:
          type: string
        status:
          $ref: '#/components/schemas/TicketStatus'
          default: TODO
        priority:
          $ref: '#/components/schemas/TicketPriority'
          default: low
        storyPoints:
          type: integer
          minimum: 0
          default: 0
        epicId:
          type: string
        assigneeId:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
      required: [projectId, title]

    UpdateTicketDto:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        status:
          $ref: '#/components/schemas/TicketStatus'
        priority:
          $ref: '#/components/schemas/TicketPriority'
        storyPoints:
          type: integer
          minimum: 0
        epicId:
          type: string
        assigneeId:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        aiInsights:
          type: string

    CreateUserDto:
      type: object
      properties:
        username:
          type: string
        email:
          type: string
          format: email
      required: [username, email]

    UpdateUserDto:
      type: object
      properties:
        username:
          type: string
        email:
          type: string
          format: email

    Error:
      type: object
      properties:
        error:
          type: string
        errors:
          type: array
          items:
            type: object
            properties:
              path:
                type: string
              message:
                type: string
      required: [error]
